\documentclass[11pt,a4aper]{article}
\pdfoutput=1

\usepackage[utf8]{inputenc}
\usepackage{polski}
\usepackage[lf,enc=t1]{berenis}
\usepackage[main=english,polish]{babel}

\renewcommand{\baselinestretch}{1}
\usepackage[UKenglish]{isodate}
\cleanlookdateon

%%%%% Fonts, symbols, colours, microtypography
\usepackage{amsfonts,amsmath,amssymb,amsthm,mathtools,microtype} % Symbols & microtypography
\usepackage[dvipsnames]{xcolor} % Colours with names -- see https://www.overleaf.com/learn/latex/Using_colours_in_LaTeX for list
\usepackage[noBBpl]{mathpazo} % Palatino, but not for mathbb

%%%%% Figures, tables, lists
\usepackage[labelsep=period,labelfont=bf,justification=centering]{caption}
\usepackage{float,graphicx,subcaption}
\usepackage{enumitem}
\setlist[itemize]{topsep=0ex,itemsep=0ex,parsep=0.4ex}
\setlist[enumerate]{topsep=0ex,itemsep=0ex,parsep=0.4ex}

\usepackage{parskip,fullpage}
\usepackage{thm-restate}
\usepackage[textsize=scriptsize]{todonotes}
\setlength{\marginparwidth}{2cm}%to have larger todonotes
\usepackage{comment}

\usepackage{array}


%%%%% Hyperlinking
\usepackage[hyphens]{url} % Urls together with line breaking them
\usepackage[linktoc=all,hidelinks,colorlinks,unicode=true]{hyperref} % Must be loaded after url
\usepackage[capitalise,compress,nameinlink,noabbrev]{cleveref} % Must be loaded after hyperref
\hypersetup{linkcolor={blue!70!black},citecolor={black},urlcolor={blue!70!black}}
\usepackage{hyperref}

\usepackage{tikz}
\usetikzlibrary{decorations.markings}
\tikzstyle{classic}=[draw=black,fill = black,inner sep = 1pt,circle]

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{claim}[theorem]{Claim}
\newtheorem*{claim*}{Claim}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{question}[theorem]{Question}
% \theoremstyle{definition}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{problem}[theorem]{Problem}

\makeatletter
\def\namedlabel#1#2{\begingroup
   \def\@currentlabel{#2}%
   \label{#1}\endgroup
}
\makeatother

\newenvironment{poc}{\begin{proof}[Proof of
    Claim]\renewcommand*{\qedsymbol}{$\blacksquare$}}{\end{proof}}

\newenvironment{csproblem}[1]{\textsc{#1}:\\}{}


\crefname{subsection}{Subsection}{Subsections}

%%%%% Renew commands

\renewcommand{\ge}{\geqslant}
\renewcommand{\le}{\leqslant}
\renewcommand{\geq}{\geqslant}
\renewcommand{\leq}{\leqslant}
% \renewcommand{\eps}{\varepsilon}
\renewcommand{\emptyset}{\varnothing}

%%%%% mathbold and mathcal
\newcommand*{\eps}{\varepsilon}
\newcommand*{\bE}{\mathbb{E}}
\newcommand*{\bN}{\mathbb{N}}
\newcommand*{\bP}{\mathbb{P}}
\newcommand*{\bR}{\mathbb{R}}
\newcommand*{\bZ}{\mathbb{Z}}
\newcommand*{\cF}{\mathcal{F}}
\newcommand*{\cO}{\mathcal{O}}
\newcommand*{\cE}{\mathcal{E}}
\newcommand*{\cI}{\mathcal{I}}
\newcommand*{\cJ}{\mathcal{J}}
\newcommand*{\cR}{\mathcal{R}}
\newcommand*{\cC}{\mathcal{C}}
\newcommand*{\cX}{\mathcal{X}}
\newcommand*{\cG}{\mathcal{G}}
\newcommand*{\cY}{\mathcal{Y}}
\newcommand*{\cB}{\mathcal{B}}
\newcommand*{\cS}{\mathcal{S}}
\newcommand*{\cD}{\mathcal{D}}
\newcommand*{\cM}{\mathcal{M}}
\newcommand*{\cP}{\mathcal{P}}
\newcommand*{\cQ}{\mathcal{Q}}
\newcommand*{\cA}{\mathcal{A}}
\newcommand*{\cU}{\mathcal{U}}
\DeclareMathOperator{\sq}{\square}

\DeclarePairedDelimiter{\set}{\{}{\}}
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}

% Colors
\newcommand{\colora}{Goldenrod}
\newcommand{\colorb}{SkyBlue}
\newcommand{\colorc}{Sepia}
\newcommand{\colord}{orange}
\newcommand{\colore}{MidnightBlue}
\newcommand{\colorf}{white}
\newcommand{\colorg}{black}

\newcommand{\cola}{\coloredbullet{\colora}}
\newcommand{\colb}{\coloredbullet{\colorb}}
\newcommand{\colc}{\coloredbullet{\colorc}}
\newcommand{\cold}{\coloredbullet{\colord}}
\newcommand{\cole}{\coloredbullet{\colore}}
\newcommand{\colf}{\coloredbullet{\colorf}}
\newcommand{\colg}{\coloredbullet{\colorg}}

  
%%% Comments
\newcommand{\bartosz}[1]{{\color{blue} BW: #1}}
\newcommand{\clement}[1]{{\color{orange} CL: #1}}
\newcommand{\nicolas}[1]{{\color{purple} UG: #1}}
\newcommand{\ugo}[1]{{\color{red} NT: #1}}

\title{Shift graph recognition is NP-complete}

\date{\today}

\author{
Bartosz Walczak\footnotemark[1] \and 
Cl\'ement Legrand-Duchesne\footnotemark[1]\and
Ugo Giocanti\footnotemark[1] \and
Nicolas Trotignon\footnotemark[2]
}

\begin{document}
\maketitle

\renewcommand{\thefootnote}{\fnsymbol{footnote}} % Make affiliation marks symbols

\footnotetext[1]{Theoretical Computer Science Department, Faculty of Mathematics and Computer Science, Jagiellonian University, Krak√≥w, Poland.}
\footnotetext[2]{}

\renewcommand{\thefootnote}{\arabic{footnote}} % Return to normal footnote symbols

\begin{abstract}
\end{abstract}

\begin{table}[h!]
  \centering
  \begin{tabular}{|l|c|c|c|}
    \hline
    Graph class & Recognition & Minimum Independent set & 3-Colouring \\
    \hline
    Mycielski & P & NPC & NPC \\
    Zykov & NPC \cite{marin2024Structural}& NPC & NPC \\
    Blanche-Descartes & NPC \cite{marin2024Structural} & NPC & NPC \\
    Burling & P \cite{rzazewski2024Polynomial} & P \cite{rzazewski2024Polynomial} & NPC \\
    Twincut & P & NPC & NPC  \\
    Shift & NPC & NPC & NPC \\
    \hline
  \end{tabular}  
  \caption{Complexity of Recognition, Minimum independent set and 3-Colouring of
    the main constructions of triangle-free graph of large chromatic number}
  \label{tab:complexity}
\end{table}

\paragraph{Line digraphs}
We say that a vertex $u$ of a digraph is \emph{transitive} if it is neither a
source nor a sink.
Given a digraph $D$, the \emph{line digraph} $L(D)$ of $D$ is the digraph whose
vertices are the arcs of $D$ and in which there is an arc from $a$ to $b$ if the
head of $a$ is the tail of $b$ in $D$. The \emph{$k$-iterated line digraph} $L^k(D)$
of $D$ is then defined recursively by $L^k(D) = L(L^{k-1}(D))$ and $L^0(D) = D$.
Equivalently, the vertices of $L^k(D)$ are the directed walks on $k+1$ vertices
in $D$ and $L^k(D)$ contains an arc from $a$ to $b$ if the corresponding
directed walks overlap on the $k$ last vertices of $a$ and the $k$ first vertices
of $b$, namely $a = (v_0, \dots v_k)$ and $b=(v_1, \dots v_{k+1})$ with
$(v_i,v_{i+1}) \in A(D)$ for all $i$. The \emph{support} of a digraph $D$ is the
non-directed graph $G$ obtained by removing the orientations of the arcs of $D$,
that is $V(G) = V(D)$ and $E(G) = \{\{x,y\} \colon (x,y) \in A(D)\}$. 

The shift graph $G_{n,k}$ is the graph whose vertices are ordered $k$-tuples
$(a_1, \dots a_k)$ of $[n]$ such that $1 \le a_1 < a_2 < \dots < a_k \le n$, in
which two vertices $a = (a_1, \dots a_k)$ and $b = (b_1, \dots b_k)$ are
adjacent if $b_i = a_{i+1}$ for all $i \in [k-1]$ (or $a_i = b_{i+1}$ for all
$i \in [k-1]$). From this definition, it is straightforward to check that
$G_{n,k}$ is the support of the $(k-1)$-iterated line digraph of the transitive
tournament on $n$ vertices. The graph $G_{n,k}$ has odd-girth $2k+1$, in
particular shift graphs are triangle-free.

The following result of Beineke characterise line digraphs of digraphs.
\begin{lemma}[Beineke~\cite{beineke1968Derived}]\label{lem:forbidden_config}
  A digraph $D$ is the line digraph of a digraph $D'$ if and only if the two
  following conditions are satisfied:
  \begin{enumerate}
  \item If $D$ contains three arcs $a$, $b$ and $c$ such that $a$ and $b$ have
    the same tail, and $b$ and $c$ have the same head, then $D$ also contains an
    arc from the tail of $c$ to the head of $a$.
  \item $D$ does not contain four arcs $a$, $b$, $c$ and $d$ such that the tails
    of $a$ and $c$ are identical, the heads of $d$ and $b$ are identical, and
    the head of $a$ (resp. $c$) is the tail of $b$ (resp. $d$).  
  \end{enumerate}
\end{lemma}
% \begin{figure}[ht]
%   \centering
%   \begin{subfigure}{.4\textwidth}
%     \centering
%     \begin{tikzpicture}
%       \node[classic] (1) at (0,0);
%       \node[classic] (2) at (1,.5);
%       \node[classic] (3) at (1,-.5);
%       \node[classic] (4) at (2,0);

%       \draw (1) -> (2);
%       \draw (1) -> (3);
%       \draw (2) -> (4);     
%     \end{tikzpicture}
%     \caption{Consistent neighbourhoods}
%     \label{sfig:config1}
%   \end{subfigure}%
%   \hfill
  
%   \begin{subfigure}{.4\textwidth}
%     \centering
%     \begin{tikzpicture}
%       \node[classic] (1) at (0,0);
%       \node[classic] (2) at (1,.5);
%       \node[classic] (3) at (1,-.5);
%       \node[classic] (4) at (2,0);

%       \draw (1) -> (2);
%       \draw (1) -> (3);
%       \draw (2) -> (4);     
%     \end{tikzpicture}
%     \caption{Forbidden configuration, Condition 2:Consistent neighbourhoods}
%     \label{sfig:config2}
%   \end{subfigure}%
%   \caption{Characterisation of orientations of line digraphs.}
%   \label{fig:config_line_digraph}
% \end{figure}
Note that the second condition forbids parallel arcs in $D'$, while the first
one ensures that the all arcs of $D'$ entering a fixed vertex have identical
out-neighbourhood in $D$. Moreover, note
that these two conditions ensure that the only allowed orientations of the 4-cycles
of $D$ are the cyclic ones and the ones alternating at each vertex.

Beineke's characterisation shows that line digraphs of digraphs can be
recognised in polynomial time. However, Chv\'atal and Ebenegger showed that
recognising their support is NP-complete~\cite{chvatal1990Note}.

\paragraph{Shift graphs}
The class of $k$-shift graphs (or simply shift graphs for $k=2$) is the
hereditary closure of the graphs $\{G_{n,k} : n \ge 1\}$, that is, all induced
subgraph of some $G_{n,k}$. Note that this definition is equivalent to saying
that $k$-shift graphs are the supports of the $(k-1)$-iterated line digraphs of
all directed acyclic graphs. Equivalently, shift graphs are often defined by
their interval representation and the natural acyclic orientation that arises
from it: the vertices of a shift graph are indexed by intervals $[a,b]$ with
$1 \le a < b \le n$, and contains an arc from $[a,b]$ to $[c,d]$ if $b = c$. More precisely,
\begin{lemma}\label{lem:valid}
  A graph is a shift graph if and only if it admits an acyclic orientation that
  is the line digraph of a digraph.
\end{lemma}
As a result all 4-cycles in the natural orientation of a shift graph are
alternating at each vertex.

\section{Recognising supports of line digraphs}
\clement{With Ugo, we noticed a mistake in our proof for high girth. Here is a
  sktch of proof for girth 4. We simplified the clause gadget to a path with
  four pending edges.}

By Schaefer's dichotomy theorem, the following problem is NP-complete. 
\begin{csproblem}{Monotone Not all equal (MNAE3SAT)}
  Given a monotone 3-CNF formula $\phi$ (in conjonctive normal form with three
  non-negated variables per clause), recognise if there exists an assignment to
  the variables such that each clause of $\phi$ contains true and false variables.
\end{csproblem}



\begin{theorem}
  Recognising a shift graph (or equivalently, the support of the line digraph of
  a digraph) is an NP-complete problem.
\end{theorem}
\begin{proof}
  We reduce \textsc{MNAE3SAT} to the shift graph recognition problem.

  \paragraph{Gadgets}
  Let $\phi$ be a monotone 3-CNF formula. We first describe the gadget used for the
  variables. Let $H$ be the 4-sun, that is the graph on eight vertices composed
  of a 4-cycle with one pending edge attached to each of the vertices of the
  cycle. Let $m$ be the number of clauses. For each variable $x$, consider the
  gadget composed of a path on $8m-1$ vertices $u_x^0, \dots, u_x^{8m-2}$ in
  which we connect each $u_x^{2i}$ to a vertex $v_x^{2i}$ itself adjacent to
  $w_x^{2i}$. Finally, connect each $u_x^{2i}$ to a distinct copy of $H$ via one
  of the vertices of degree three that we will call $t_x^{2i}$ (see
  \cref{fig:variable_gadget}). For each variable $x$, denote $H_x$ the copy of
  this gadget.
  \begin{figure}[h!]
    \centering
    \begin{tikzpicture}[scale = 1]
      \foreach \i in {0,...,7}{
        \begin{scope}[shift={(2*\i,0)}]
          \node[classic] (a\i) at (0,0) {};
          
          \node[classic] (e\i1) at (0,-.75) {};
          \node[classic] (e\i2) at (0,-1.5) {};

          \node[classic] (H\i11) at (0,.5) {};
          \node[classic] (H\i12) at (-.25,.25) {};
          \node[classic] (H\i21) at (.25,.75) {};
          \node[classic] (H\i22) at (.5,.75) {};
          \node[classic] (H\i31) at (0,1) {};
          \node[classic] (H\i32) at (0,1.25) {};
          \node[classic] (H\i41) at (-.25,.75) {};
          \node[classic] (H\i42) at (-.5,.75) {};
          \draw (H\i11) -- (H\i21) -- (H\i31) -- (H\i41) -- (H\i11);
          \draw (H\i11) -- (a\i) -- (e\i1) -- (e\i2) ;
          \foreach \j in {1,...,4}{
            \draw (H\i\j1) -- (H\i\j2);
          }
          
        \end{scope}        
        
      }
      \foreach \i in {0,...,6}{
        \node[classic] (b\i) at (2*\i+1,0) {};
        \pgfmathsetmacro{\j}{\i+1}
        \draw (a\i) -- (b\i) -- (a\j);
      }

      \node[below left] at (a0) {\small $u_x^0$};
      \node[below left] at (e01) {\small $v_x^0$};
      \node[below left] at (e02) {\small $w_x^0$};
      \node[below left] at (a1) {\small $u_x^2$};
      \node[below left] at (b0) {\small $u_x^1$};
      \node[below left] at (e11) {\small $v_x^2$};
      \node[below left] at (e12) {\small $w_x^2$};
      \node[below right] at (a7) {\small $u_x^{8m-2}$};
      \node[below right] at (e71) {\small $v_x^{8m-2}$};
      \node[below right] at (e72) {\small $w_x^{8m-2}$};
    \end{tikzpicture}  
    \caption{Variable gadget $H_x$}
    \label{fig:variable_gadget}    
  \end{figure}
  
  For each $i \in {0, \dots m-1}$, we attach the gadgets of the variable
  appearing in the $i$-th clause $C_i$ as follows. Let $x, y, z$ be the
  variables appearing in $C_i$. Add three edges to form a path $a_ib_ic_id_i$,
  where $a_i=w_x^{8i}$, $b_i=w_y^{8i+2}$, $c_i=w_y^{8i+6}$ and
  $d_i=w_z^{8i}$. Denote $G_\phi$ the constructed graph.

  \paragraph{Line digraph orientations of $G_\phi$}
  We will say that an orientation of a graph is \emph{valid} if it is acyclic
  and forms a line digraph. Before proving that there is an assignment such that
  $\phi$ has true and false variables in each clause if and only if $G_\phi$
  admits a valid orientation, we prove several lemmas describing valid
  orientations of $G_\phi$ and some of its subgraphs.

  \begin{claim}\label{cl:sun_orientation}
    There are only two valid orientations of the 4-sun, which are opposite (see
    ~\cref{fig:sun_orientation}). In these orientations, the 4-cycle is
    alternating and all vertices of degree three are transitive.
  \end{claim}
  \begin{figure}[ht]
    \centering
    \begin{tikzpicture}[decoration={
        markings,
        mark=at position 0.5 with {\arrow[scale=1.5]{>}}}
      ]
      
      \node[classic] (a) at (0,0) {};
      \node[classic] (a') at (-1,0) {};
      \node[classic] (b) at (1,1) {};
      \node[classic] (b') at (1,2) {};
      \node[classic] (c) at (2,0) {};
      \node[classic] (c') at (3,0) {};
      \node[classic] (d) at (1,-1) {};
      \node[classic] (d') at (1,-2) {};

      \draw[postaction={decorate}] (a) -- (b);
      \draw[postaction={decorate}] (c) -- (b);
      \draw[postaction={decorate}] (a) -- (d);
      \draw[postaction={decorate}] (c) -- (d);

      \draw[postaction={decorate}] (a') -- (a);
      \draw[postaction={decorate}] (b) -- (b');
      \draw[postaction={decorate}] (c') -- (c);
      \draw[postaction={decorate}] (d) -- (d');

    \end{tikzpicture}
    \caption{The only valid orientation of the 4-sun (and its opposite).}
    \label{fig:sun_orientation}
  \end{figure}
  \begin{poc}
    Let $D$ be a digraph with a valid orientation and whose support is the
    4-sun. By~\cref{lem:valid}, the 4-cycle $C$ of $D$ is alternating at each
    vertex. Let $v$ a vertex of degree three. Without loss of generality, assume
    that $v$ has two out-neighbours in $C$. Let $u$ be the remaining neighbour
    of $v$, and $w$ and $x$ be two vertices of $C$ such that $w$ is adjacent to
    $v$, while $x$ is not. So $D$ contains the arcs $v \to w$ and $x \to
    w$. Since $D$ is the line digraph of a graph, by the first condition
    of~\cref{lem:forbidden_config}, the edge between $u$ and $v$ is oriented
    towards $v$, hence $v$ is not a source and $D$ is of the form depicted
    on~\cref{fig:sun_orientation}.
  \end{poc}


  For each variable $x$, denote $A_x$ the subgraph of $H_x$ induced by
  $\bigcup_{i=0}^{4m-1} \{t_x^{2i}, u_x^{2i}, u_x^{2i+1}, v_x^{2i}, w_x^{2i}\}$.

  \begin{claim}\label{cl:gadget_orientation}
   
    Consider a valid orientation of $H_x$. There are only two possible orientations for
    its restriction to the subgraph induced by $A_x$, which are opposite. If
    $w_x^0 \to v_x^0$ then for all $i$, we have $w_x^{2i} \to v_x^{2i}$ if $i$
    is even and $v_x^{2i} \to w_x^{2i}$ if $i$ is odd.
  \end{claim}
  \begin{poc}
    Without loss of generality, assume that $w_x^0 \to v_x^0$.
    By~\cref{cl:sun_orientation}, each copy of the 4-sun in $H_x$ is oriented
    such that all the vertices of degree three are transitive (however,
    each copy of the 4-sun may be oriented independently to any of its two
    possible orientations).

    Let $i \in \{0,...,4m-1\}$ and assume that $t^{2i}_x \to u^{2i}_x$
    (respectively $u^{2i}_x \to t^{2i}_x$). By \cref{cl:sun_orientation},
    $t^{2i}_x$ is transitive in the copy of the 4-sun it belongs
    to, so $t^{2i}_x$ has an outneighbour (resp. an inneighbour). Therefore,
    $u^{2i+1}_x$, $u^{2i-1}_x$ and $v^{2i}_x$ are all outneighbours of
    $u^{2i}_x$ (resp. inneighbours). As $v^{2i}_xu^{2i}_xu^{2i+1}_x$ is an
    alternating path, we also have $v^{2i}_x \to w^{2i}_x$ and $u^{2i+1}_x \to
    u^{2i+2}_x$ (respectively $w^{2i}_x \to v^{2i}_x$ and $u^{2i+2}_x \to
    u^{2i+1}_x$). The result follows from a  straightforward induction on $i$.
  \end{poc}


  Let $D$ be the graph formed by a path of length three and four pending edges
  $e_1, \dots e_4$, attached to the vertices of the path. Given an valid
  orientation, we say that $e_1$ and $e_4$ (respectively $e_2$ and $e_3$) are
  \emph{positive} if they are orientaed away (resp. towards) the path, and that
  they are \emph{negative} otherwise.
  
  \begin{claim}\label{cl:clause_orientation}
    In any valid orientation, the edges $e_i$ cannot be all positive, or all
    negative. Conversely, any orientation of the edges $e_i$ such that $e_2$
    and $e_3$ are both positive (or both negative), and the edges $e_i$ are not
    all positive (or all negative) can be extended onto $D$ into a valid orientation. 
  \end{claim}
  \begin{poc}
    Assume that there exists a valid orientation of $D$ with all edges $e_i$
    positive. Label $a,b,c,d$ the internal vertices of $D$. Without loss of
    generality, assume that $b \to c$. As $c$ has both an in and an
    outneighbour, the edge $ab$ is oriented $a \to b$. Hence $b$ has also an in
    and an outneighbour and $e_1$ is negative. By the symmetry, if we had $c \to
    b$, $e_4$ would be negative.

    Conversely, consider an orientation of $e_1, \dots e_4$, such that $e_2$
    and $e_3$ are say positive, but not all four edges are positive. Say without
    loss of generality $e_1$ is negative. Then orienting $D$ as on picture
    \cref{fig:variable_gadget} forms a line digraph by
    \cref{lem:forbidden_config}.

    \begin{figure}[h!]
      \centering
      \begin{tikzpicture}[decoration={
        markings,
        mark=at position 0.5 with {\arrow[scale=1.5]{>}}}
      ]
        \foreach \i in {1,...,4}{
          \node[classic] (a\i) at (\i,0) {};
          \node[classic] (b\i) at (\i,1) {};
          \node at (\i-.3,.5) {\small $e_\i$};
        }
        
        \draw[postaction={decorate}] (a1) -- (a2);
        \draw[postaction={decorate}] (a2) -- (a3);
        \draw[postaction={decorate}] (a3) -- (a4);
        
      \draw[postaction={decorate}] (b1) -- (a1);
      \draw[postaction={decorate}] (b2) -- (a2);
      \draw[postaction={decorate}] (b3) -- (a3);
      \draw (b4) -- (a4);
          
      \end{tikzpicture}
      \caption{A valid orientation of $D$. The edge $e_1$ is negative, $e_2$ and
        $e_3$ are negative, and $e_4$ can eihter be positive or negative.}
      \label{fig:variable_gadget}
    \end{figure}
  \end{poc}

  \paragraph{Equivalence of the instances}
  We are now ready to prove that $\phi$ admits an assignment such that each
  clause contain true and false variables with different values if and only if
  $G_\phi$ is a shift graph.

  We first prove the direct implication. Consider such an assignment. For all
  variable $x$ choose the orientation of $H_x$ such that $w^{0}_x \to v^{0}_x$
  (by \cref{cl:gadget_orientation} there exists only one such orientation. The
  only edges that remain to be oriented are the edges forming the path in the
  variable gadget. Let $C_i$ be a clause of $\phi$, $D_i$ the corresponding
  subgraph of $G_\phi$, with $e_1,\dots e_4$ the edges attached to the vertices
  of the path of length three. By construction and \cref{cl:gadget_orientation},
  $e_2$ and $e_3$ are either both negative or both positive. Since $C_i$
  contains true and false variables, we can apply \cref{cl:clause_orientation}
  to orient the remaining edges of $D_i$. The orientation we constructed is
  valid when restricted to each $D_i$ and to each $H_x$. To check that is forms
  a valid orientation of $G_\phi$, we only need to check the first condition of
  \cref{lem:forbidden_config} at the junctions between the clause and the
  variables gadgets, and the orientations of the cycles using these
  junctions. Note that any such cycle must pass by some $u^{2i}_x$, at which it
  alternates. Finally, as each $u^{2i}_xv^{2i}_xw^{2i}_x$ forms a
  non-alternating path, the first condition of \cref{lem:forbidden_config} is
  satisfied and the orientation of $G_\phi$ is that of an acyclic line
  digraph. In other words, $G_\phi$ is a shift graph.

  We now prove the reverse implication. Consider a valid orientation of
  $G_\phi$. For each variable $x$, assign $x$ to true if $w^{0}_x \to v^0_x$ and
  to false otherwise. Let $C_i$ be a clause of $\phi$ and $D_i$ the
  corresponding variable gadget. By construction and by
  \cref{cl:gadget_orientation}, each of the edges $e_1, \dots e_4$ attached to
  the internal vertices of $D_i$ is positive if and only if the corresponding
  variable is true. By \cref{cl:clause_orientation}, the edges $e_1, \dots e_4$
  cannot be all positive or all negative because the orientation is valid. Hence
  $C_i$ contains a true and a false variable, which concludes the proof.
\end{proof}

\nocite{*}
\bibliographystyle{abbrv}
\bibliography{references}
\end{document}

